<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PeerReviewApp.views &mdash; Manuscript Review 1.0beta1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0beta1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Manuscript Review 1.0beta1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/projtitle.png" width = "50%" border="0" alt="peer review"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for PeerReviewApp.views</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">render_to_response</span><span class="p">,</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">Http404</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">logout</span><span class="p">,</span> <span class="n">get_user</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span><span class="p">,</span> <span class="n">user_passes_test</span>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">model_to_dict</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="c">#from filetransfers.api import prepare_upload</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">EmptyPage</span><span class="p">,</span> <span class="n">PageNotAnInteger</span>
<span class="kn">from</span> <span class="nn">PeerReviewApp.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PeerReviewApp.forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">uuid4</span>
<span class="kn">import</span> <span class="nn">json</span>


<div class="viewcode-block" id="handle_reviewer_uploads"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.handle_reviewer_uploads">[docs]</a><span class="k">def</span> <span class="nf">handle_reviewer_uploads</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Method for dealing with the reviewer&#39;s uploaded review document &#39;&#39;&#39;</span>
    <span class="n">upload_dir</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">REVIEW_DOC_PATH</span><span class="p">)</span>
    <span class="n">upload_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">,</span> <span class="n">upload_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">upload_full_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">upload_full_path</span><span class="p">)</span>

    <span class="c"># Get  first uploaded file</span>
    <span class="n">upload</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s">&#39;file&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">ext</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">upload_full_path</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">upload</span><span class="o">.</span><span class="n">chunks</span><span class="p">():</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="n">dest</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">upload</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">upload_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="handle_uploads"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.handle_uploads">[docs]</a><span class="k">def</span> <span class="nf">handle_uploads</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Method for dealing with uploaded files &#39;&#39;&#39;</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">upload_dir</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">UPLOAD_PATH</span><span class="p">)</span>
    <span class="n">upload_full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">,</span> <span class="n">upload_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">upload_full_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">upload_full_path</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">upload</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s">&#39;file&#39;</span><span class="p">):</span>
        <span class="c"># Ensure file uploads are unique</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="n">ext</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">upload_full_path</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">upload</span><span class="o">.</span><span class="n">chunks</span><span class="p">():</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">saved</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">upload</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">upload_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">saved</span>

</div>
<div class="viewcode-block" id="get_current_review_period"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.get_current_review_period">[docs]</a><span class="k">def</span> <span class="nf">get_current_review_period</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">ReviewPeriod</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ReviewPeriod</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="index"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.index">[docs]</a><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Main landing page &#39;&#39;&#39;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="about"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.about">[docs]</a><span class="k">def</span> <span class="nf">about</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;about.html&#39;</span><span class="p">,</span> <span class="p">{})</span>
</div>
<div class="viewcode-block" id="terms"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.terms">[docs]</a><span class="k">def</span> <span class="nf">terms</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Terms of service agreement &#39;&#39;&#39;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;terms.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="auth_login"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.auth_login">[docs]</a><span class="k">def</span> <span class="nf">auth_login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="s">&#39;email&#39;</span> <span class="ow">in</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span> <span class="ow">and</span> <span class="s">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;hit 2&#39;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">],</span> <span class="n">password</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span>  <span class="c"># Redirect to homepage when the user logs in</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Authentication failed.&#39;</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="signup"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.signup">[docs]</a><span class="k">def</span> <span class="nf">signup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SignupForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">SignupForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
        <span class="c"># Passwords don&#39;t match</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;retype_password&#39;</span><span class="p">]:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;The passwords you entered do not match.&#39;</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;signup.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

        <span class="c"># Not an Emory email address</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;@emory.edu&#39;</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Sorry! This service is only available within Emory University.&#39;</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;signup.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

        <span class="c"># A user already exists with this email</span>
        <span class="k">if</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;A user already exists with this email.&#39;</span>
            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;signup.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

        <span class="c"># Create the new user</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            If we are going to add email authentication, this would be the place to add it.</span>
<span class="sd">            I believe this requires messing around with some Django stuff though, so I&#39;m</span>
<span class="sd">            going to leave it for later.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">clean_retype_password</span><span class="p">()</span>
        <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>  <span class="c"># Log the user in</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span>  <span class="c"># Redirect them to the home page</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;signup.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="agreement"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.agreement">[docs]</a><span class="k">def</span> <span class="nf">agreement</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Agree to the form &#39;&#39;&#39;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AgreementForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AgreementForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;agreement.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="auth_logout"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.auth_logout">[docs]</a><span class="k">def</span> <span class="nf">auth_logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;logout.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="has_agreed"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.has_agreed">[docs]</a><span class="k">def</span> <span class="nf">has_agreed</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">agreed_to_form</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="reviewer_home"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.reviewer_home">[docs]</a><span class="k">def</span> <span class="nf">reviewer_home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_current_review_period</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;reviewer_home.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="remove_associated_file"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.remove_associated_file">[docs]</a><span class="k">def</span> <span class="nf">remove_associated_file</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">fid</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;hit this&#39;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">():</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">ManuscriptFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">fid</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">context</span><span class="p">[</span><span class="s">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Deleted manuscript file&#39;</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Http404</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="submit_manuscript"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.submit_manuscript">[docs]</a><span class="k">def</span> <span class="nf">submit_manuscript</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">mid</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">manuscript</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">mid</span><span class="p">)</span>
    <span class="n">manuscript</span><span class="o">.</span><span class="n">is_final</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">manuscript</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">&#39;Submitted&#39;</span>
    <span class="n">manuscript</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;manuscript&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manuscript</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;uploader_home.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="delete_manuscript"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.delete_manuscript">[docs]</a><span class="k">def</span> <span class="nf">delete_manuscript</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">mid</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">manuscript</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">mid</span><span class="p">)</span>
    <span class="n">manuscript</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="n">manuscript</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;manuscript&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manuscript</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;delete_manuscript.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="edit_manuscript"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.edit_manuscript">[docs]</a><span class="k">def</span> <span class="nf">edit_manuscript</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">mid</span><span class="p">):</span>
	<span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>

	<span class="c"># If the user has made changes</span>
	<span class="k">if</span> <span class="s">&#39;submitbutton&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
		<span class="c"># Need to write method to update form and associated files</span>
		<span class="n">man</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
		<span class="n">form</span> <span class="o">=</span> <span class="n">UploadManuscript</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">man</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
			<span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

		<span class="n">saved_files</span> <span class="o">=</span> <span class="n">handle_uploads</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">saved_files</span><span class="p">:</span>
			<span class="n">m</span> <span class="o">=</span> <span class="n">ManuscriptFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">upload</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">manuscript</span><span class="o">=</span><span class="n">man</span><span class="p">)</span>
			<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="s">&#39;uploader_home.html&#39;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>

		<span class="c">#Get the current user and the manuscript being edited</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
		<span class="n">manuscript</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">mid</span><span class="p">)</span>

		<span class="c"># Make sure the manuscript they&#39;re trying to edit is theirs and that it can be edited</span>
		<span class="k">if</span> <span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
		    <span class="n">context</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;You are not authorized to make changes to this manuscript.&#39;</span>
		    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;edit_manuscript.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">is_final</span><span class="p">:</span>
		    <span class="n">context</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;This manuscript can no longer be edited.&#39;</span>
		    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;edit_manuscript.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

		<span class="n">form</span> <span class="o">=</span> <span class="n">UploadManuscript</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">manuscript</span><span class="p">)</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>

		<span class="n">files</span> <span class="o">=</span> <span class="n">ManuscriptFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">manuscript</span><span class="o">=</span><span class="n">manuscript</span><span class="p">)</span>
		<span class="n">context</span><span class="p">[</span><span class="s">&#39;files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>

		<span class="n">context</span><span class="p">[</span><span class="s">&#39;manuscript&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manuscript</span>

		<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;edit_manuscript.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="browse_manuscripts"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.browse_manuscripts">[docs]</a><span class="k">def</span> <span class="nf">browse_manuscripts</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">current_page</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_current_review_period</span><span class="p">()</span>

    <span class="c"># Load all available manuscripts</span>
    <span class="n">all_manuscripts</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c"># Create a paginator with the manuscripts</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">all_manuscripts</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PageNotAnInteger</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>

    <span class="n">context</span><span class="p">[</span><span class="s">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;browse_manuscripts.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="assigned_manuscripts"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.assigned_manuscripts">[docs]</a><span class="k">def</span> <span class="nf">assigned_manuscripts</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">current_page</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_current_review_period</span><span class="p">()</span>

    <span class="c"># Load the current user and get the manuscripts for which they are a reviewer</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="n">manuscripts_assigned</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">reviewers__in</span><span class="o">=</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;manid&#39;</span><span class="p">)</span>
        <span class="n">man</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">mid</span><span class="p">)</span>
        <span class="n">saved_file</span> <span class="o">=</span> <span class="n">handle_reviewer_uploads</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">ReviewFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">saved_file</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">upload</span><span class="o">=</span><span class="n">saved_file</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">manuscript</span><span class="o">=</span><span class="n">man</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">man</span><span class="o">.</span><span class="n">reviewdocs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="n">man</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c"># Create a paginator</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">manuscripts_assigned</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">current_page</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PageNotAnInteger</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>

    <span class="n">context</span><span class="p">[</span><span class="s">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;assigned_manuscripts.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="author_home"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.author_home">[docs]</a><span class="k">def</span> <span class="nf">author_home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_current_review_period</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;uploader_home.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">has_agreed</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/agreement/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="upload_manuscript"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.upload_manuscript">[docs]</a><span class="k">def</span> <span class="nf">upload_manuscript</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_current_review_period</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UploadManuscript</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">man</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c"># Set current user as author</span>
            <span class="n">current_user</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
            <span class="n">man</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_user</span><span class="p">]</span>

            <span class="n">saved_files</span> <span class="o">=</span> <span class="n">handle_uploads</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">saved_files</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">ManuscriptFile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">upload</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">manuscript</span><span class="o">=</span><span class="n">man</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c"># If successful, redirect to main page</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;authorhome&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UploadManuscript</span><span class="p">()</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;upload_manuscript.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="account"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.account">[docs]</a><span class="k">def</span> <span class="nf">account</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;delete&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Deleting account &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="s">&#39;savebutton&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AccountForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">context</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Information saved.&#39;</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">AccountForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;account.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="auth_admin"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.auth_admin">[docs]</a><span class="k">def</span> <span class="nf">auth_admin</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">!=</span> <span class="s">&#39;b.k.bolte@emory.edu&#39;</span><span class="p">:</span> <span class="c"># Update admin authentication at some point</span>
		<span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span>
	<span class="n">context</span><span class="p">[</span><span class="s">&#39;all_users&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;admin_home.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="is_site_admin_check"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.is_site_admin_check">[docs]</a><span class="k">def</span> <span class="nf">is_site_admin_check</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
		<span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">is_site_admin</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="admin_login"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.admin_login">[docs]</a><span class="k">def</span> <span class="nf">admin_login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="c">#context_dict = {}</span>
	<span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="c">#context[&#39;next&#39;] = request.GET.get(&#39;next&#39;, False)</span>
	<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span> <span class="n">form</span> <span class="o">=</span> <span class="n">AdminLoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span> <span class="n">form</span> <span class="o">=</span> <span class="n">AdminLoginForm</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="s">&#39;email&#39;</span> <span class="ow">in</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span> <span class="ow">and</span> <span class="s">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">:</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">],</span> <span class="n">password</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin_homepage&#39;</span><span class="p">))</span> <span class="c"># Redirect to homepage when the user logs in</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">context</span><span class="p">[</span><span class="s">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Authentication failed.&#39;</span>
	<span class="n">context</span><span class="p">[</span><span class="s">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span>
	<span class="c">#return render_to_response(&#39;login.html&#39;, context, context_instance=RequestContext(request))</span>
	<span class="c">#return render_to_response(&#39;admin_login.html&#39;, context_dict)</span>
	<span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;admin_login.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

<span class="c">#@login_required(login_url=&#39;/admin_login&#39;)</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="admin_homepage"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.admin_homepage">[docs]</a><span class="k">def</span> <span class="nf">admin_homepage</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">context_dict</span> <span class="o">=</span> <span class="p">{}</span>

	<span class="n">period</span> <span class="o">=</span> <span class="n">ReviewPeriod</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_current</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">submission_deadline</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">submission_deadline</span>
		<span class="n">review_deadline</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">review_deadline</span>
		<span class="n">group_meeting_time</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group_meeting_time</span>
		<span class="n">group_meeting_venue</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group_meeting_venue</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">submission_deadline</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="n">review_deadline</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="n">group_meeting_time</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="n">group_meeting_venue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;submission_deadline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">submission_deadline</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;review_deadline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review_deadline</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;group_meeting_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_meeting_time</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;group_meeting_venue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_meeting_venue</span>
	<span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;admin_homepage.html&#39;</span><span class="p">,</span> <span class="n">context_dict</span><span class="p">,</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MatchedManuscript"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.MatchedManuscript">[docs]</a><span class="k">class</span> <span class="nc">MatchedManuscript</span><span class="p">():</span>
	<span class="n">manuscript</span> <span class="o">=</span> <span class="n">Manuscript</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">recommended_reviewers</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MatchedManuscript.add"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.MatchedManuscript.add">[docs]</a>	<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reviewer</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">recommended_reviewers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reviewer</span><span class="p">)</span>

<span class="c">#view to handle admin confirm final decision ajax call</span></div></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="admin_confirm_ajax"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.admin_confirm_ajax">[docs]</a><span class="k">def</span> <span class="nf">admin_confirm_ajax</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;manuscript_id&#39;</span><span class="p">):</span>
			<span class="n">manuscript_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;manuscript_id&#39;</span><span class="p">)</span>
			<span class="n">manuscript</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">manuscript_id</span><span class="p">)</span>
			<span class="n">manuscript</span><span class="o">.</span><span class="n">is_final</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="n">manuscript</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

			<span class="n">response_dict</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="n">reviewers_dict</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">for</span> <span class="n">reviewer</span> <span class="ow">in</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">reviewers</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
				<span class="n">reviewers_dict</span><span class="p">[</span><span class="n">reviewer</span><span class="o">.</span><span class="n">email</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">star_string</span><span class="p">}</span>

			<span class="n">author</span> <span class="o">=</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;manuscript&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;title&#39;</span><span class="p">:</span><span class="n">manuscript</span><span class="o">.</span><span class="n">brief_title</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">:</span><span class="n">manuscript</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span><span class="n">author</span><span class="o">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">author</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span> <span class="n">author</span><span class="o">.</span><span class="n">star_string</span><span class="p">}</span>
			<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;reviewers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reviewers_dict</span>
			<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;true&#39;</span>


	<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="s">&#39;code&#39;</span><span class="p">:</span> <span class="s">&#39;KeyError&#39;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_dict</span><span class="p">),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

<span class="c">#view to handle admin submit final decision ajax call</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="admin_submit_ajax"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.admin_submit_ajax">[docs]</a><span class="k">def</span> <span class="nf">admin_submit_ajax</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;manuscript_id&#39;</span><span class="p">):</span>
			<span class="n">manuscript_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;manuscript_id&#39;</span><span class="p">)</span>
			<span class="n">manuscript</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">manuscript_id</span><span class="p">)</span>

			<span class="n">response_dict</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="n">reviewer_dict</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="k">for</span> <span class="n">reviewer</span> <span class="ow">in</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">reviewers</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
				<span class="n">reviewer_dict</span><span class="p">[</span><span class="n">reviewer</span><span class="o">.</span><span class="n">email</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">star_string</span><span class="p">,</span> <span class="s">&#39;email&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>

			<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;reviewers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reviewer_dict</span>
			<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;constraint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">warning</span>
			<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;true&#39;</span>

	<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="s">&#39;code&#39;</span><span class="p">:</span> <span class="s">&#39;KeyError&#39;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

	<span class="k">return</span> 	<span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_dict</span><span class="p">),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

<span class="c">#view to handle admin edit ajax call</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="admin_ajax"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.admin_ajax">[docs]</a><span class="k">def</span> <span class="nf">admin_ajax</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;manuscript_id&#39;</span><span class="p">):</span>
			<span class="n">manuscript_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;manuscript_id&#39;</span><span class="p">)</span>
			<span class="n">manuscript</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">manuscript_id</span><span class="p">)</span>

			<span class="c">#get new set of reviewers</span>
			<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;reviewers&#39;</span><span class="p">):</span>
				<span class="n">reviewers</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;reviewers&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
				<span class="n">reviewers</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

				<span class="c">#store the new set of reviewers</span>
				<span class="n">manuscript</span><span class="o">.</span><span class="n">reviewers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">reviewer</span> <span class="ow">in</span> <span class="n">reviewers</span><span class="p">:</span>
					<span class="n">manuscript</span><span class="o">.</span><span class="n">reviewers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">reviewer</span><span class="p">))</span>
				<span class="n">response_dict</span> <span class="o">=</span> <span class="p">{}</span>
				<span class="n">assigned_dict</span> <span class="o">=</span> <span class="p">{}</span>
				<span class="n">recommend_dict</span> <span class="o">=</span> <span class="p">{}</span>

				<span class="k">for</span> <span class="n">reviewer</span> <span class="ow">in</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">reviewers</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
					<span class="n">assigned_dict</span><span class="p">[</span><span class="n">reviewer</span><span class="o">.</span><span class="n">email</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">star_string</span><span class="p">,</span> <span class="s">&#39;email&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>

				<span class="k">for</span> <span class="n">reviewer</span> <span class="ow">in</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">recommended_reviewers</span><span class="p">:</span>
					<span class="n">recommend_dict</span><span class="p">[</span><span class="n">reviewer</span><span class="o">.</span><span class="n">email</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">last_name</span> <span class="o">+</span> <span class="n">reviewer</span><span class="o">.</span><span class="n">star_string</span><span class="p">,</span> <span class="s">&#39;email&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">:</span><span class="n">reviewer</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>

				<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;assigned&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assigned_dict</span>
				<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;recommend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recommend_dict</span>
				<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;constraint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">warning</span>
				<span class="n">response_dict</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;true&#39;</span>

	<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="s">&#39;code&#39;</span><span class="p">:</span> <span class="s">&#39;KeyError&#39;</span><span class="p">}),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_dict</span><span class="p">),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

<span class="c">#@login_required(login_url=&#39;/admin_login&#39;)</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="admin_browselist"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.admin_browselist">[docs]</a><span class="k">def</span> <span class="nf">admin_browselist</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">context_dict</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">manuscripts</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="n">manuscripts_all</span> <span class="o">=</span> <span class="n">Manuscript</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

	<span class="c">#get current period</span>
	<span class="n">period</span> <span class="o">=</span> <span class="n">ReviewPeriod</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_current</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">submission_deadline</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">submission_deadline</span>
		<span class="n">review_deadline</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">review_deadline</span>
		<span class="n">group_meeting_time</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group_meeting_time</span>
		<span class="n">group_meeting_venue</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">group_meeting_venue</span>

		<span class="c">#review period constrain</span>
		<span class="k">for</span> <span class="n">manuscript</span> <span class="ow">in</span> <span class="n">manuscripts_all</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">manuscript</span><span class="o">.</span><span class="n">review_period</span><span class="o">.</span><span class="n">is_current</span><span class="p">:</span>
				<span class="n">manuscripts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">manuscript</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">submission_deadline</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="n">review_deadline</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="n">group_meeting_time</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="n">group_meeting_venue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

	<span class="n">reviewers</span> <span class="o">=</span> <span class="n">SiteUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">agreed_to_form</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;manuscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manuscripts</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;reviewers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reviewers</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;submission_deadline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">submission_deadline</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;review_deadline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review_deadline</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;group_meeting_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_meeting_time</span>
	<span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;group_meeting_venue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_meeting_venue</span>
	<span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;admin_browselist.html&#39;</span><span class="p">,</span> <span class="n">context_dict</span><span class="p">,</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>


<span class="c">#@login_required(login_url=&#39;/admin_login&#39;)</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="manuscript_detail"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.manuscript_detail">[docs]</a><span class="k">def</span> <span class="nf">manuscript_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
	<span class="n">manuscript</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Manuscript</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
	<span class="c">#return render(request, &#39;manuscript_detail.html&#39;, {&#39;manuscript&#39;: manuscript})</span>
	<span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;manuscript_detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;manuscript&#39;</span><span class="p">:</span> <span class="n">manuscript</span><span class="p">},</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

<span class="c">#@login_required(login_url=&#39;/admin_login&#39;)</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="user_detail"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.user_detail">[docs]</a><span class="k">def</span> <span class="nf">user_detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">SiteUser</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
	<span class="c">#return render(request, &#39;user_detail.html&#39;, {&#39;user&#39;: user})</span>
	<span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;user_detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">},</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

<span class="c">#@login_required(login_url=&#39;/admin_login&#39;)</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="setting"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.setting">[docs]</a><span class="k">def</span> <span class="nf">setting</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
		<span class="n">form</span> <span class="o">=</span> <span class="n">ReviewPeriodForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">ReviewPeriod</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
				<span class="n">period</span><span class="o">.</span><span class="n">is_current</span> <span class="o">=</span> <span class="bp">False</span>
				<span class="n">period</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="c">#ReviewPeriod.objects.all().delete();</span>
			<span class="n">period</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="n">period</span><span class="o">.</span><span class="n">is_current</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="n">period</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">ReviewPeriod</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
				<span class="k">print</span> <span class="n">period</span><span class="o">.</span><span class="n">is_current</span>
			<span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;setting_ok.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;period&quot;</span><span class="p">:</span><span class="n">period</span><span class="p">},</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">form</span> <span class="o">=</span> <span class="n">ReviewPeriodForm</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;setting.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">},</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

<span class="c">#@login_required(login_url=&#39;/admin_login&#39;)</span></div>
<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">is_site_admin_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="admin_logout"><a class="viewcode-back" href="../../code.html#PeerReviewApp.views.admin_logout">[docs]</a><span class="k">def</span> <span class="nf">admin_logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/admin_login&#39;</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../search.html">search</a>|&nbsp;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Peng Ji and PeerReview team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b1.
    </div>
  </body>
</html>